!function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=7)}([function(t,e){t.exports={get_todo_data:function(t){let e={};return t.querySelectorAll("[name]").forEach(function(t){switch(t.nodeName){case"INPUT":switch(t.type){case"text":case"password":case"number":case"hidden":e[t.name]=t.value;break;case"checkbox":case"radio":e[t.name]=t.checked}break;case"TEXTAREA":case"SELECT":e[t.name]=t.value;break;default:alert("No corresponding value")}}),e},set_todo_data:function(t,e){for(let i in e){let n=e[i],o=t.querySelector(`[name =${i}]`);switch(typeof n){case"number":case"string":o.value=n;break;case"boolean":o.checked=n}}},clear_form:function(t){t.querySelector("[name = title]").value="",t.querySelector("[name = id]").value=""}}},function(t,e,i){let n=i(4);function o(t,e){this.max_id=e,this.list=t,this.$load_list(this.list,this.max_id)}function s(t,e){return t.findIndex(function(t){return t.id==e})}t.exports=o,o.prototype.$add=function(t){t.id=this.max_id++,this.list.unshift(t),this.$sync_to()},o.prototype.$remove=function(t){if(t<0)return;this.list.splice(s(this.list,t),1),this.$sync_to()},o.prototype.$modify=function(t,e){let i=s(this.list,t),n=this.list[i];this.list[i]=Object.assign({},n,e),this.$sync_to()},o.prototype.$read=function(){return this.list},o.prototype.$find_row_id=function(t){return function(t,e){return t.find(function(t){return t.id==e})}(this.list,t)},o.prototype.$sync_to=function(){n.set(this._model_name+"-list",this.list),n.set(this._model_name+"-max_id",this.max_id)},o.prototype.$sync_from=function(){return{list:n.get(this._model_name+"-list",this.list),max_id:n.set(this._model_name+"-max_id",this.max_id)}},o.prototype.$load_list=function(t,e){this.list=this.$sync_from().list||t,this.max_id=this.$sync_from().max_id||e}},function(t,e,i){let n=i(1);t.exports=s;let o=[{title:"默认",id:1}];function s(t){this._model_name="cat",this.max_id=t||2,this.config={title:{max_length:10}},this.list=o||[],n.call(this,o,this.max_id)}s.prototype=Object.create(n.prototype),s.prototype.add=function(t){if(t.title.length>this.config.title.max_length)throw`title should not greater than ${this.config.title.max_length}`;if(!t.title)return;return this.$add(t)},s.prototype.remove=function(t){return this.$remove(t)},s.prototype.modify=function(t,e){return this.$modify(t,e)},s.prototype.read=function(){return this.$read()}},function(t,e,i){let n=i(2),o=i(0);function s(t){this._model_name="cat";let e=this.config=Object.assign({},{form_selector:"#cat-form",add_btn_selector:"#add-cat",list_selector:"#cat-list",click_fn:null,delete_fn:null,add_fn:null},t);this.form=document.querySelector(e.form_selector),this.add_btn=document.querySelector(e.add_btn_selector),this.list=document.querySelector(e.list_selector),this._api=new n,this.updating_item=null}t.exports=s,s.prototype.clear_form=o.clear_form,s.prototype.get_todo_data=o.get_todo_data,s.prototype.set_todo_data=o.set_todo_data,s.prototype.init=function(){this.detect_submit_list(),this.detect_click_form(),this.detect_add_btn(),this.detect_list(),this.render()},s.prototype.detect_add_btn=function(){let t=this;this.add_btn.addEventListener("click",function(){t.show_form()})},s.prototype.detect_click_form=function(){let t=this;this.form.addEventListener("click",function(e){e.target.classList.contains("cancel")&&(t.hide_form(),t.show_updating_item(),t.reset_form_location())})},s.prototype.render=function(){let t=this;this.reset_form_location(),this.list.innerHTML="",this._api.read().forEach(function(e){t.list.innerHTML+=`\n        <div class="cat-item cl_fl" data-id="${e.id}">\n            <div class="cat-title">${e.title}</div>\n            <div class="tool-set">\n                ${1==e.id?"":'\n                    <button class="cat-modify">修改</button>\n                    <button class="cat-delete">删除</button>\n                    '}\n            </div>\n        </div>\n        `}),t._api.$sync_to()},s.prototype.detect_list=function(){let t=this;this.list.addEventListener("click",function(e){let i,n=e.target.classList.contains("cat-delete"),o=e.target.classList.contains("cat-modify"),s=e.target.closest(".cat-item");if(s&&(i=parseInt(s.dataset.id)),n){if(!confirm("确认删除？"))return;t.remove_row(i),t.config.delete_fn&&t.config.delete_fn(i)}else if(o){t.updating_item&&(t.updating_item.hidden=!1);let e=t._api.$find_row_id(i);t.set_todo_data(t.form,e),t.show_form(),s.hidden=!0,s.insertAdjacentElement("afterend",t.form),t.updating_item=s}else{if(!i)return;t.set_item_active(i),t.config.click_fn&&t.config.click_fn(i)}})},s.prototype.remove_row=function(t){this._api.remove(t),this.render()},s.prototype.show_form=function(){this.form.hidden=!1},s.prototype.hide_form=function(){this.form.hidden=!0},s.prototype.detect_submit_list=function(){let t=this;this.form.addEventListener("submit",function(e){if(e.preventDefault(),""==t.form.querySelector("[name = title]").value)return;let i=t.get_todo_data(t.form);i.id?t._api.modify(i.id,i):t._api.add(i),t.clear_form(t.form),t.render(),t.hide_form(),t.config.add_fn&&t.config.add_fn()})},s.prototype.show_updating_item=function(){this.updating_item&&(this.updating_item.hidden=!1)},s.prototype.set_item_active=function(t){this.list.querySelectorAll(".cat-item").forEach(function(e){e.dataset.id==t?e.classList.add("cat-active"):e.classList.remove("cat-active")})},s.prototype.reset_form_location=function(){this.list.insertAdjacentElement("afterend",this.form),this.clear_form(this.form)}},function(t,e){t.exports={set:function(t,e){let i=JSON.stringify(e);localStorage.setItem(t,i)},get:function(t){let e=localStorage.getItem(t);return JSON.parse(e)}}},function(t,e,i){let n=i(1);t.exports=s;let o=[{id:1,title:"起床",completed:!0,cat_id:1}];function s(t){this._model_name="task",this.max_id=t||2,this.list=o||[],n.call(this,this.list,this.max_id)}s.prototype=Object.create(n.prototype),s.prototype.add=function(t){if(!t.title)return;t.cat_id||(t.cat_id=1);return this.$add(t)},s.prototype.remove=function(t){return this.$remove(t)},s.prototype.modify=function(t,e){return this.$modify(t,e)},s.prototype.read=function(){return this.list=this.$read()},s.prototype.read_by_cat=function(t){return this.read().filter(function(e){return e.cat_id==t})},s.prototype.remove_cat_row=function(t){this.list=this.list.filter(function(e){return e.cat_id!=t})},s.prototype.set_completed=function(t,e){let i=this.$find_row_id(t);if(!i)return!1;i.completed=e,this.$sync_to()}},function(t,e,i){let n=i(5),o=i(0);function s(t){this._model_name="task";let e=this.config=Object.assign({},{form_selector:"#task-form",list_selector:"#task-list",completed_list_selector:".completed",incomplete_list_selector:".incomplete",input_selector:"#task-input",select_selector:"#task-select",init_fn:null,input_focus:null,input_blur:null,add_succeed_fn:null},t);this.form=document.querySelector(e.form_selector),this.input=document.querySelector(e.input_selector),this.list=document.querySelector(e.list_selector),this.completed_list=this.list.querySelector(e.completed_list_selector),this.incomplete_list=this.list.querySelector(e.incomplete_list_selector),this.select=document.querySelector(e.select_selector),this._api=new n}function r(t){return`\n    <div class="task-item cl_fl" data-id="${t.id}">\n        <div class="check"  data-id="${t.cat_id}">\n            <input class="checker" type="checkbox" ${t.completed?"checked":""}>\n        </div>\n        <div class="col detail">\n            <div class="title">${t.title}</div>\n        </div>\n        <div class="tool-set" data-id="${t.cat_id}">\n            <button class="task-modify">修改</button>\n            <button class="task-delete">删除</button>\n        </div>\n    </div>\n`}t.exports=s,s.prototype.remove_row=function(t){this._api.remove(t),this.render()},s.prototype.clear_form=o.clear_form,s.prototype.get_todo_data=o.get_todo_data,s.prototype.set_todo_data=o.set_todo_data,s.prototype.init=function(){this.render(1),this.detect_submit(),this.detect_list(),this.config.init_fn&&this.config.init_fn();this.detect_input_focus(),this.detect_input_blur()},s.prototype.render=function(t){let e=this,i=t?this._api.read_by_cat(t):this._api.read(),n='<div class="empty">空</div>';this.incomplete_list.innerHTML=this.completed_list.innerHTML="",i.forEach(function(t){t.completed?e.completed_list.innerHTML+=r(t):e.incomplete_list.innerHTML+=r(t)}),this.incomplete_list.innerHTML||(this.incomplete_list.innerHTML=n);this.completed_list.innerHTML||(this.completed_list.innerHTML=n)},s.prototype.detect_submit=function(){let t=this;this.form.addEventListener("submit",function(e){if(e.preventDefault(),""==t.form.querySelector("[name = title]").value)return;let i=t.get_todo_data(t.form);i.id?t._api.modify(i.id,i):t._api.add(i),t.config.input_blur&&t.config.input_blur(),t.config.add_succeed_fn&&t.config.add_succeed_fn(i.cat_id),t.render(i.cat_id),t.clear_form(t.form),t.form.querySelector("[type = submit]").innerHTML="添加"})},s.prototype.detect_list=function(){let t=this;this.list.addEventListener("click",function(e){let i,n=e.target.classList.contains("task-delete"),o=e.target.classList.contains("task-modify"),s=e.target.classList.contains("checker"),r=e.target.closest(".task-item");if(r&&(i=parseInt(r.dataset.id)),n)t.remove_row(i),t.render(e.target.closest(".tool-set").dataset.id);else if(o){let e=t._api.$find_row_id(i);t.set_todo_data(t.form,e),t.form.querySelector("[type = submit]").innerHTML="确认"}else s&&(t._api.set_completed(i,e.target.checked),t.render(e.target.closest(".check").dataset.id))})},s.prototype.detect_input_focus=function(){let t=this;this.input.addEventListener("focus",function(){t.config.input_focus&&t.config.input_focus()})},s.prototype.detect_input_blur=function(){let t=this;this.input.addEventListener("blur",function(){t.config.input_blur&&t.config.input_blur()})}},function(t,e,i){let n=i(6),o=i(3),s=new n({init_fn:c,input_focus:function(){s.select.hidden=!1},input_blur:function(){},add_succeed_fn:function(t){r.set_item_active(t)}}),r=new o({click_fn:function(t){var e;e=t,s.select.querySelectorAll("option").forEach(function(t){t.value==e&&(t.selected=!0)}),s.render(t)},delete_fn:function(t){s._api.remove_cat_row(t),s.render()},add_fn:c});function c(){s.select.innerHTML="",r._api.read()&&(r._api.read().forEach(function(t){s.select.innerHTML+=`\n        <option class="cat-option" value="${t.id}">${t.title}</option>\n        `}),s.select.addEventListener("change",function(t){let e=parseInt(t.target.value);r.set_item_active(e),s.render(e)}))}s.init(),r.init()}]);