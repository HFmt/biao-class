<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>localStorage</title>
    <style>
    #history-list {
        background: #fff;
        border: 1px solid rgba(0, 0, 0, .2);
        border-top: 0;
        font-size: 14px;
        -webkit-box-shadow: 0 2px 4px rgba(0, 0, 0, .1);
        -moz-box-shadow: 0 2px 4px rgba(0, 0, 0, .1);
        box-shadow: 0 2px 4px rgba(0, 0, 0, .1);
        cursor: default;
        }
    .history {
        padding: 5px 10px;
        font-size: 0;
    }
    .history:hover {
        background: rgba(0, 0, 200, .1);
    }
    .history .text,
    .history .tool {
        vertical-align: middle;
        display: inline-block;
    }
    .history .text {
        width: 70%;
        font-size: .9rem;
    }
    .history .tool {
        display: none;
        width: 30%;
        font-size: .6rem;
        text-align: right;
        cursor: pointer;
        color: #aaa;
    }
    .history:hover .tool {
        display: inline-block;
    }
    </style>
</head>
<body>
    <form id="search-form" action="">
        <input id="search-ipt" type="text">
        <button id="search-btn">搜索</button>
    </form>
        <div id="history-list" hidden>
            <div class="history"></div>
        </div>

</body>

<script>
    let el_history_list = document.getElementById('history-list')
      , el_form = document.getElementById('search-form')
      , el_input = document.getElementById('search-ipt')
      , history_list
      , arr_element = []
      , keywords
      ;
      
    el_form.addEventListener('submit', function (e) {
        e.preventDefault();
        arr_element.push(el_input.value);
        
        stroe_set('Asam', arr_element);
        reload_history_list();
        render_history_list();
        show_elenemt();
    });

    function reload_history_list() {
        history_list = stroe_get('Asam') || [];
    }

    function render_history_list() {
        let  el_history 
           , el_delete_history
           ;
            el_history_list.innerHTML = '';

        history_list.forEach(function (history) {
            el_history = document.createElement('div');
            el_history.classList.add('history');
            el_history.dataset.history = history;
            el_history.innerHTML = 
            `<div class="text">${history}</div>
             <div class="tool">
                <span class="delete">删除</span>
             </div>
            `
            el_delete_history = el_history.getElementsByClassName('delete')[0];

            reverse_appendChild(el_history_list, el_history)
            el_history.addEventListener('click', function (e) {
                if(e.target.classList.contains('delete')){
                    return;
                }
                set_keyword(this.dataset.history);        
            });
           
            delete_click_history(el_delete_history);
        });
    }

    function reverse_appendChild(el_father, el_children){
        if(el_father.children[0]){
            el_father.insertBefore(el_children,el_father.children[0]);
            }
            else{
                el_father.appendChild(el_children);
            }
    }

    //触发删除历史记录按钮事件
    function  delete_click_history(this_delete) {
                this_delete.addEventListener('click', function () { 
                let this_history = this.closest('.history').dataset.history
                  , loca_index = arr_element.indexOf(this_history)
                  ;           
                
                delete_history(this.closest('.history'), loca_index);
                // overwrite_history_list(history_list);
                
                stroe_set('Asam', arr_element);
                reload_history_list();
                show_elenemt();
             });
    }

    //删除历史搜索记录
    function delete_history(closest, index) {
        el_history_list.removeChild(closest);
        arr_element.indexOf(closest);
        arr_element.splice(index, 1);
    }

    function overwrite_history_list(data) {
        stroe_set('Asam', data);
    }

    //搜索框键入历史搜索记录的值
    function set_keyword(keyword) {
        el_input.value = keyword;
        keywords = keyword;
    }
    
    //以JSON格式设置localStorage.setItem
    function stroe_set(key, val) {
        let set_json = JSON.stringify(val);
        localStorage.setItem(key, set_json);
    }

    //取消JSON格式获取localStorage.getItem
    function stroe_get(key) {
        let get_json = localStorage.getItem(key);
        return JSON.parse(get_json);
    }

    //显示隐藏历史搜索容器
    function show_elenemt() {
        if (el_history_list.innerHTML == '') {
            el_history_list.hidden = true;
        }else{
            el_history_list.hidden = false;
        }
    }
</script>
</html>