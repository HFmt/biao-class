<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <style>
    *{
      box-sizing: border-box;
    }
    body{
      background: #eee;
    }
    button{
      cursor:pointer;
    }
    img {
      width: 60px;
      height: 60px;
    }
    a{
      text-decoration: none;
    }
    .container{
      max-width: 599px;
      margin: 0 auto;
    }
    #search-form{
      font-size: 0;
    }
    #search-input,
    button{
      font-size: 15px;
      padding: 10px;
      line-height: 1.1;
      border: 1px solid #000;
    }
    #search-input{
      width: 80%;
    }
    #search-button{
      width: 20%;
    }
    .user{
      background: #fff;
      border: 1px solid #000;
      margin: 5px 0;
    }
    .user > *{
      display: inline-block;
      padding: 5px;
      color: #555;
      font-size: 80%;
      vertical-align: top;
    }
    .user .info > * {
      margin-bottom: 2px;
    }
    .username {
      font-size: 15px;
      font-weight: bold;
      color: #333;
    }
    .avatar{
      border: 1px solid #000;
      padding: 0;
      font-size: 0;
    }
    .tolbar{
      position: fixed;
      right: 0;
      bottom: 0;
     
    }
    #top{
      padding: 10px;
      background: #000;
      color: #fff;
    }
    .active{
      border: 1px solid yellow;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>GitHub用户搜索</h2>
    <form action="" id="search-form">
        <input type="search" name="" id="search-input">
        <button type="submit" id="search-button">搜索</button>
    </form>
    <div id="user-list">
       
    </div>
    <div id="pagination-container">
      <div id="pagination">
      </div>
    </div>
  </div>
  <div class="tolbar">
    <button id="top">Top</button>
  </div>
</body>
<script>
  ;(function () {
    'use strict';

      let search_form = document.getElementById('search-form')
      , search_input = document.getElementById('search-input')
      , user_list = document.getElementById('user-list')
      , pagination = document.getElementById('pagination')
      , come_top = document.getElementById('top')
      , page = 1
      , limit = 5
      , amount
      , page_amount
      , max_page = 5
      ;

      init();
  
      function init() {
        on_form_submit();
        detect_click_top();
      }
      
      function render_pagination() {
        pagination.innerHTML = '';
        get_page_amount();
        let start_page 
          , middle = Math.ceil(max_page/2)
          , end_page = max_page
        ;

        if(page <= middle){
          start_page = 1;
          end_page = max_page;
        }
        else if(page >= page_amount - middle){
          start_page = page_amount - max_page;
          end_page = page_amount;
        }
        else{
          start_page = page - middle + 1;
          end_page = page + middle - 1;
        }

        if(start_page <1){
          start_page = 1;
        }
        if(end_page > page_amount){
          end_page = page_amount;
        }

        for (let i = start_page; i<=end_page; i++){
          let btn = document.createElement('button');
          btn.innerText = i;
          pagination.appendChild(btn);
          if(page == i){
            console.log(btn,page);
            btn.classList.add('active');
          }
          btn.addEventListener('click', (function make_function() {
            return function () {  
              page = i;
              search_user(search_input.value);
            }
          })());
        }
      }



      function get_page_amount() {
        page_amount = Math.ceil(amount/limit)
      }
      
      function detect_click_top() {
        come_top.addEventListener('click', function (e) {
          window.scrollTo(0, 0);
      });
      }
     
      function on_form_submit() {
        search_form.addEventListener('submit', function(e){
          e = e||window.event;
          e.preventDefault();
          search_user(search_input.value);
        });
      }
      
      function search_user(keyword) {
        let link = 'https://api.github.com/search/users?q=' + keyword + '&page=' + page + '&per_page=' + limit
        send('get', link, function (result){
          amount = result.total_count;
          render(result);
          render_pagination();
          console.log(link);
        });
      }

      function send(method, url, on_success) {
        let http = new XMLHttpRequest();
        http.open(method, url);
        http.send();

        http.addEventListener('load', function () {
          let data = JSON.parse(this.responseText);
          on_success(data);
        });
      }

      function render(data) {
      let html = '';
      data.items.forEach(function (user) {
        html += 
          `<div class="user">
          <a class="avatar" target="_blank" href="${user.html_url}">
            <img src="${user.avatar_url}">
          </a>
          <div class="info">
            <div class="username">${user.login}</div>
            <div><a target="_blank" href="${user.html_url}">${user.html_url}</a></div>
          </div>
        </div>`
        user_list.innerHTML = html
       });
      }
  })();
  
</script>
</html>